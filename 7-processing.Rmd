---
title: "5 - Additional Processing"
output: html_notebook
---

```{r setup, echo=F, results='hide'}
library(RMySQL)
source("config.R")
source("helpers.R")
```

> This R notebook can be executed from within R, you can update the database connection properties and the dataset settings in the `config.R` file, or run the commands specified here interactively if you want to experiment. **Note that there are certain shell commands which the notebook itself will not execute.**

# Heatmaps

> This applies to all languages. 

First a helper file that contains project ids, stars and commits must be exported from the database (`projects_heat.csv`):

```{r}
exportHeatmapData(DATASET_NAME, DATASET_PATH);
```

Then call the `sccpreprocessor` to calculate the heatmaps:

    cd tools/sccpreprocessor/src
    java SccPreprocessor originals PATH_TO_DATASET NUM_CHUNKS
    cd ../../..
    
Where `NUM_CHUNKS` is number of chunks produced by the clone finder (i.e. how many threads the clone finder used). This produces `heatmap.csv`, which contains for each project a row with the following:

- project id
- number of stars 
- number of commits
- number of original files in the project
- number of clones the project contains

# JavaScript

## Tokenizer Extra Information

JavaScript tokeizer produces extra information for its projects and files, stored in the `projects_extra.txt` and `files_extra.txt` files. When imported, these will add columns to the `projects` and `files` tables. The `importJSExtras` function in `functions.R` does this:

```{r}
importJSExtras(DATASET_NAME, DATASET_PATH)
```

## File Types

For JavaScript, we also calculate kinds of files. Files can be `npm`, or `bower` files, tests, `min.js` files, locale files and other properties (file name w/o extension, npm package name, aand first npm package name (blame). To calculate this information, `sccpreprocessor` must be executed first to create `files_nm.csv`:


    cd tools/sccpreprocessor/src
    java SccPreprocessor nm ../../../datasets/js
    cd ../../..
    
When done, the file can be imported into the database and a database with `_nonpm` suffix can be created, which would contain only non-npm files:    
    
```{r}
importAndCreateJS_NPM(paste(DATASET_NAME, "nonpm", sep = "_"), DATASET_NAME, DATASET_PATH)
```

## Next Steps

[Project Clones](6-project-clones.Rmd) in file `6-project-clones.Rmd`.

    
